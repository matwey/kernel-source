From: Josef Bacik <jbacik@fusionio.com>
Date: Wed, 31 Jul 2013 10:28:05 -0400
Patch-mainline: 3.12
Git-commit: 6596a9281995a3c7dee8ca6666bd169fffc928e1
Subject: [PATCH] Btrfs: don't bug_on when we fail when cleaning up
 transactions

There is no reason for this sort of jackassery.  Thanks,

Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: Chris Mason <chris.mason@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/transaction.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/fs/btrfs/transaction.c
+++ b/fs/btrfs/transaction.c
@@ -1942,6 +1942,5 @@ int btrfs_clean_one_deleted_snapshot(str
 	 * If we encounter a transaction abort during snapshot cleaning, we
 	 * don't want to crash here
 	 */
-	BUG_ON(ret < 0 && ret != -EAGAIN && ret != -EROFS);
-	return 1;
+	return (ret < 0) ? 0 : 1;
 }
